{{> menu }}

<section class="section">
  <h1 class="title">Placemark: {{placemark.title}} <small class="is-size-6">by {{owner.username}}</small></h1>
  <a href="/dashboard/edit/{{details._id}}" class="button">
      <span class="icon is-small">
        <i class="fas fa-pen"></i>
      </span>
    </a>

  {{#if placemark.category}}
  <div class="box">
    <h2 class="title is-5">Category</h2>
    {{#if placemark.category}}
      <div class="tags">
        <span class="tag">{{placemark.category}}</span>
      </div>
    {{else}}
      <p class="has-text-grey">No category</p>
    {{/if}}
  </div>
  {{/if}}

  {{#if placemark.images}}
  <div class="box">
    <h2 class="title is-5">Images</h2>
    {{#if placemark.images.length}}
      <div class="columns is-multiline is-mobile is-1">
        {{#each placemark.images}}
          <div class="column is-narrow">
              <img src="{{this}}" alt="Placemark image" width="200" style="border: 1px solid #ccc;">
          </div>
        {{/each}}
      </div>
    {{else}}
      <p class="has-text-grey">No images</p>
    {{/if}}
  </div>
  {{/if}}

  <div class="box">
     <h2 class="title is-5">Location</h2>
     <div class="columns">
       <div class="column">
         <h3 class="subtitle">Standard</h3>
         <div id="map-detail" style="height: 300px; width: 100%;"></div>
       </div>
       <div class="column">
         <h3 class="subtitle">Satellite</h3>
         <div id="map-satellite" style="height: 300px; width: 100%;"></div>
       </div>
       <div class="column">
         <h3 class="subtitle">Nautical</h3>
         <div id="map-nautical" style="height: 300px; width: 100%;"></div>
       </div>
     </div>
  </div>

  <div>
  {{> list-details details}}
  </div>

  <div class="columns is-multiline mt-4">
    <div class="column is-6">
      {{> add-comment}}
    </div>
    <div class="column is-6">
      {{> list-comments comments=comments}}
    </div>
  </div>

</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const lat = Number("{{details.latitude}}");
    const lng = Number("{{details.longitude}}");
    const title = "{{placemark.title}}";
    
    if (lat && lng && (lat !== 0 || lng !== 0)) {
        // Standard Map
        const map = L.map('map-detail').setView([lat, lng], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);
        L.marker([lat, lng]).addTo(map).bindPopup(title);

        // Satellite Map
        const mapSat = L.map('map-satellite').setView([lat, lng], 13);
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
        }).addTo(mapSat);
        L.marker([lat, lng]).addTo(mapSat).bindPopup(title);

        // Nautical Map
        const mapNautical = L.map('map-nautical').setView([lat, lng], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; OpenStreetMap contributors'
        }).addTo(mapNautical);
        L.tileLayer('https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png', {
            attribution: 'Map data: &copy; <a href="http://www.openseamap.org">OpenSeaMap</a> contributors'
        }).addTo(mapNautical);
        L.marker([lat, lng]).addTo(mapNautical).bindPopup(title);

    } else {
        const noDataHtml = "<p class='has-text-grey'>No valid location data available</p>";
        document.getElementById('map-detail').innerHTML = noDataHtml;
        document.getElementById('map-satellite').innerHTML = noDataHtml;
        document.getElementById('map-nautical').innerHTML = noDataHtml;
    }
  });
</script>